<?xml version="1.0"?>
<!DOCTYPE cache-config SYSTEM "cache-config.dtd">

<!-- 
    File: coherence-messagingpattern-cache-config.xml
    
    Copyright (c) 2008. All Rights Reserved. Oracle Corporation.

    Oracle is a registered trademark of Oracle Corporation and/or its
    affiliates.

    This software is the confidential and proprietary information of Oracle
    Corporation. You shall not disclose such confidential and proprietary
    information and shall use it only in accordance with the terms of the
    license agreement you entered into with Oracle Corporation.

    Oracle Corporation makes no representations or warranties about 
    the suitability of the software, either express or implied, 
    including but not limited to the implied warranties of 
    merchantability, fitness for a particular purpose, or 
    non-infringement.  Oracle Corporation shall not be liable for 
    any damages suffered by licensee as a result of using, modifying 
    or distributing this software or its derivatives.

    This notice may not be removed or altered.
  -->

<cache-config>
    <introduce:config file="coherence-common-cache-config.xml"/>
    
    <caching-scheme-mapping>

        <!-- 
            NOTE: ALONG WITH THE CACHE-SCHEME-MAPPINGS DEFINED BELOW, 
            IN ORDER TO USE THE MESSAGING PATTERN YOU MUST ALSO INCLUDE 
            THE CACHE-SCHEME-MAPPINGS SECTION FROM THE COMMAND PATTERN 
            FILE commandpattern-cacheconfig.xml IN YOUR APPLICATION 
            CACHE-CONFIG.XML
        -->

        <!-- BEGIN: com.oracle.coherence.patterns.messaging
        
             The following section needs to be included in your application 
             Cache Configuration file to make use of Messaging 
        -->
        <cache-mapping>
            <cache-name>coherence.messagingpattern.subscriptions</cache-name>
            <scheme-name>distributed-scheme-for-subscriptions</scheme-name>
            <init-params>
                <init-param>
                    <param-name>backing-map-listener-class-name</param-name>
                    <param-value>com.oracle.coherence.common.backingmaplisteners.DelegatingBackingMapListener</param-value>
                </init-param>
            </init-params>
        </cache-mapping>

        <cache-mapping>
            <cache-name>coherence.messagingpattern.messages</cache-name>
            <scheme-name>distributed-scheme-for-messages</scheme-name>
            <init-params>
                <init-param>
                    <param-name>backing-map-listener-class-name</param-name>
                    <param-value>com.oracle.coherence.common.events.dispatching.listeners.DelegatingBackingMapListener</param-value>
                </init-param>
            </init-params>          
        </cache-mapping>
        
        <cache-mapping>
            <cache-name>coherence.messagingpattern.destinations</cache-name>
            <scheme-name>distributed-scheme-for-destinations</scheme-name>
            <init-params>
                <init-param>
                    <param-name>backing-map-listener-class-name</param-name>
                    <param-value>com.oracle.coherence.common.events.dispatching.listeners.DelegatingBackingMapListener</param-value>
                </init-param>
            </init-params>  
        </cache-mapping>
                
        <!-- END: com.oracle.coherence.patterns.messaging -->
    
    </caching-scheme-mapping>

    <caching-schemes>
    
        <!-- 
            NOTE: ALONG WITH THE CACHE-SCHEMES DEFINED BELOW, IN ORDER 
            TO USE THE MESSAGING PATTERN YOU MUST ALSO INCLUDE THE 
            CACHE-SCHEME-MAPPINGS SECTION FROM THE COMMAND PATTERN 
            FILE commandpattern-cacheconfig.xml IN YOUR APPLICATION 
            CACHE-CONFIG.XML
        -->

        <!-- BEGIN: com.oracle.coherence.patterns.messaging
        
             The following section needs to be included in your application 
             Cache Configuration file to make use of Messaging 
        -->
        <distributed-scheme>
            <scheme-name>distributed-scheme-for-subscriptions</scheme-name>
            <service-name>DistributedCacheForSubscriptions</service-name>
            <scheme-ref>distributed-scheme-with-backing-map-listener</scheme-ref>
            <autostart>true</autostart>
        </distributed-scheme>

        <distributed-scheme>
            <scheme-name>distributed-scheme-for-messages</scheme-name>
            <service-name>DistributedCacheForMessages</service-name>
            
            <key-partitioning>
                <class-name>com.oracle.coherence.patterns.messaging.MessageKey$KeyStrategy</class-name>
            </key-partitioning>
            
            <partition-listener>
                <class-name>com.oracle.coherence.patterns.messaging.MessagePartitionListener</class-name>
            </partition-listener>            

            <autostart>true</autostart>
            <thread-count>4</thread-count>

            <backing-map-scheme>
                <local-scheme>
                    <listener>
                        <class-scheme>
                            <class-name>{backing-map-listener-class-name com.oracle.coherence.common.backingmaplisteners.NullBackingMapListener}</class-name>
                            <init-params>
                                <init-param>
                                    <param-type>com.tangosol.net.BackingMapManagerContext</param-type>
                                    <param-value>{manager-context}</param-value>
                                </init-param>
                                <init-param>
                                    <param-type>java.lang.String</param-type>
                                    <param-value>{cache-name}</param-value>
                                </init-param>                                
                            </init-params>
                        </class-scheme>
                    </listener>
                </local-scheme>
            </backing-map-scheme>

            <autostart>true</autostart>
                        
        </distributed-scheme>
        
          <distributed-scheme>
            <scheme-name>distributed-scheme-for-destinations</scheme-name>
            <service-name>DistributedCacheForDestinations</service-name>

            <autostart>true</autostart>
            <thread-count>4</thread-count>

            <backing-map-scheme>
                <local-scheme>
                    <listener>
                        <class-scheme>
                            <class-name>{backing-map-listener-class-name com.oracle.coherence.common.backingmaplisteners.NullBackingMapListener}</class-name>
                            <init-params>
                                <init-param>
                                    <param-type>com.tangosol.net.BackingMapManagerContext</param-type>
                                    <param-value>{manager-context}</param-value>
                                </init-param>
                                <init-param>
                                    <param-type>java.lang.String</param-type>
                                    <param-value>{cache-name}</param-value>
                                </init-param>                                
                            </init-params>
                        </class-scheme>
                    </listener>
                </local-scheme>
            </backing-map-scheme>

            <autostart>true</autostart>
                        
        </distributed-scheme>
        
        <distributed-scheme>
            <scheme-name>distributed-scheme-with-backing-map-listener</scheme-name>
            
            <thread-count>4</thread-count>
                 
            <backing-map-scheme>
                <local-scheme>
                    <listener> 
                        <class-scheme>
                            <class-name>{backing-map-listener-class-name com.oracle.coherence.common.backingmaplisteners.NullBackingMapListener}</class-name>
                            <init-params>
                                <init-param>
                                    <param-type>com.tangosol.net.BackingMapManagerContext</param-type>
                                    <param-value>{manager-context}</param-value>
                                </init-param>
                            </init-params>
                        </class-scheme>
                    </listener>
                </local-scheme>
            </backing-map-scheme>
        </distributed-scheme>
                
        <!-- END: com.oracle.coherence.patterns.messaging -->

    </caching-schemes>
        
</cache-config>
        


