#!/appl/TeamSite/iw-home/iw-perl/bin/iwperl

use File::Find;
use CTB::RegEx;
use TeamSite::Config;
use strict;

my $iwhome = TeamSite::Config::iwgethome();

my %missing_items = (
"10L.1.1.1.06","1",
"10L.1.1.2.03","1",
"10L.1.1.2.04","1",
"10L.1.1.2.05","1",
"10L.1.1.3.01","1",
"10L.1.1.3.03","1",
"10L.1.1.4.03","1",
"10L.1.1.6.01","1",
"10L.1.1.6.03","1",
"10L.1.1.6.04","1",
"10L.1.2.1.05","1",
"10L.1.2.2.09","1",
"10L.1.2.3.01","1",
"10L.1.2.3.02","1",
"10L.1.2.3.04","1",
"10L.1.2.3.08","1",
"10L.1.2.3.10","1",
"10L.1.3.1.01","1",
"10L.1.3.1.02","1",
"10L.1.3.1.03","1",
"10L.1.3.1.04","1",
"10L.1.3.1.05","1",
"10L.1.3.1.06","1",
"10L.1.3.1.07","1",
"10L.1.3.1.08","1",
"10L.1.3.1.09","1",
"10L.1.3.1.10","1",
"10L.1.3.1.11","1",
"10L.1.3.1.12","1",
"10L.1.3.2.03","1",
"10L.1.3.2.04","1",
"10L.1.3.2.05","1",
"10L.1.3.2.06","1",
"10L.1.3.2.07","1",
"10L.1.3.2.08","1",
"10L.1.3.2.09","1",
"10L.1.3.2.10","1",
"10L.1.3.3.03","1",
"10L.1.3.3.05","1",
"10L.1.3.3.09","1",
"10L.1.3.3.10","1",
"10L.1.3.3.11","1",
"10L.1.4.1.05","1",
"10L.1.4.1.06","1",
"10L.1.4.1.07","1",
"10L.1.4.1.08","1",
"10L.1.4.2.05","1",
"10L.1.4.3.02","1",
"10L.1.4.3.03","1",
"10L.1.4.4.01","1",
"10L.1.4.4.04","1",
"10L.1.4.5.01","1",
"10L.1.4.5.05","1",
"10L.1.4.6.01","1",
"10L.1.4.6.02","1",
"10L.1.4.6.03","1",
"10L.1.4.6.04","1",
"10L.1.4.6.05","1",
"10L.1.4.7.02","1",
"10L.1.4.7.03","1",
"10L.1.5.1.01","1",
"10L.1.5.1.02","1",
"10L.1.5.1.04","1",
"10L.1.5.1.05","1",
"10L.1.5.1.06","1",
"10L.1.5.1.07","1",
"10L.1.5.1.08","1",
"10L.1.5.1.09","1",
"10L.1.5.1.10","1",
"10L.1.5.1.11","1",
"10L.1.5.1.12","1",
"10L.1.5.1.16","1",
"10L.1.5.1.19","1",
"10L.1.5.1.20","1",
"10L.1.5.1.21","1",
"10L.1.5.1.23","1",
"10L.1.5.1.25","1",
"10L.1.5.1.26","1",
"10L.1.5.1.27","1",
"10L.1.5.1.29","1",
"10L.1.5.1.32","1",
"10L.1.5.1.33","1",
"10L.1.5.1.34","1",
"10L.1.5.1.35","1",
"10L.1.5.1.36","1",
"10L.1.6.1.01","1",
"10L.1.6.1.02","1",
"10L.1.6.1.06","1",
"10L.1.6.1.07","1",
"10L.1.6.1.08","1",
"10L.1.6.1.11","1",
"10L.1.6.1.12","1",
"10L.1.6.1.13","1",
"10L.1.6.2.03","1",
"10L.1.6.2.08","1",
"10L.1.6.2.09","1",
"10L.1.6.2.10","1",
"10L.1.6.2.11","1",
"10L.1.6.2.14","1",
"10L.1.6.3.01","1",
"10L.1.6.3.02","1",
"10L.1.6.3.03","1",
"10L.1.6.3.04","1",
"10L.1.6.3.05","1",
"10L.1.6.3.06","1",
"10L.1.6.3.07","1",
"10L.1.6.3.08","1",
"10L.2.1.1.04","1",
"10L.2.1.1.05","1",
"10L.2.2.2.02","1",
"10L.2.2.2.04","1",
"10L.2.2.2.2.02","1",
"10L.2.3.02","1",
"10L.2.5.01","1",
"10L.2.5.02","1",
"10L.2.5.03","1",
"10L.2.5.04","1",
"10L.2.6.01","1",
"10L.2.6.02","1",
"10M.1.3.1.04","1",
"10M.1.4.1.01","1",
"10M.1.4.2.03","1",
"10M.1.4.2.04","1",
"10M.1.5.1.01","1",
"10M.1.5.2.02","1",
"10M.1.5.3.02","1",
"10M.2.1.1.01","1",
"10M.2.1.1.02","1",
"10M.2.1.4.01","1",
"10M.2.1.4.02","1",
"10M.2.1.5.01","1",
"10M.2.1.6.03","1",
"10M.2.1.7.01","1",
"10M.2.1.8.01","1",
"10M.2.2.1.02","1",
"10M.2.3.1.01","1",
"10M.2.3.1.05","1",
"10M.2.3.1.06","1",
"10M.2.3.1.07","1",
"10M.2.3.3.02","1",
"10M.2.3.4.01","1",
"10M.2.3.4.02","1",
"10M.2.3.4.03","1",
"10M.2.3.4.04","1",
"10M.2.3.4.05","1",
"10M.2.3.4.06","1",
"10M.2.3.4.07","1",
"10M.2.3.4.08","1",
"10M.2.3.5.01","1",
"10M.2.3.5.04","1",
"10M.2.3.5.05","1",
"10M.2.4.1.02","1",
"10M.2.4.1.03","1",
"10M.2.4.3.02","1",
"10M.2.5.1.03","1",
"10M.2.5.1.06","1",
"10M.2.5.2.01","1",
"10M.2.5.2.02","1",
"10M.2.5.2.03","1",
"10M.2.5.4.01","1",
"10M.3.1.1.02","1",
"10M.3.2.1.02","1",
"10M.3.2.2.02","1",
"10M.3.4.2.01","1",
"10M.3.4.2.02","1",
"10M.3.4.2.03","1",
"10M.3.5.1.01","1",
"10M.3.5.1.02","1",
"10M.3.5.1.03","1",
"10M.3.5.1.04","1",
"10M.3.6.1.01","1",
"10M.3.6.1.02","1",
"10M.3.7.1.01","1",
"10M.3.7.1.02","1",
"10M.3.7.1.03","1",
"10M.3.7.1.04","1",
"10M.3.8.1.01","1",
"10M.3.9.1.01","1",
"10M.4.1.1.01","1",
"10M.4.2.1.03","1",
"10M.4.4.1.03","1",
"10M.4.5.1.01","1",
"10M.5.1.1.01","1",
"10M.5.1.2.01","1",
"10M.5.5.3.01","1",
"10M.6.1.1.06","1",
"10M.6.2.1.01","1",
"10M.6.2.1.02","1",
"10M.6.2.1.05","1",
"10M.7.1.1.01","1",
"10M.7.1.1.02","1",
"10M.7.1.1.04","1",
"10M.7.2.1.02","1",
"10M.7.3.1.01","1",
"10M.7.3.1.04","1",
"10M.7.3.1.05","1",
"10M.7.3.1.06","1",
"10M.7.4.1.01","1",
"10M.7.4.1.07","1",
"10R.1.1.1.06","1",
"10R.1.1.1.07","1",
"10R.1.1.1.10","1",
"10R.1.1.1.13","1",
"10R.1.1.2.01","1",
"10R.1.2.2.01","1",
"10R.1.2.3.02","1",
"10R.1.2.3.03","1",
"10R.2.1.2.02","1",
"10R.2.1.2.03","1",
"10R.2.1.2.05","1",
"10R.2.1.2.06","1",
"10R.2.2.1.01","1",
"10R.2.2.2.01","1",
"10R.3.1.2.06","1",
"10R.3.1.2.07","1",
"10R.3.1.2.11","1",
"10R.3.1.2.13","1",
"10R.3.1.4.03","1",
"10R.3.2.12","1",
"10R.3.2.13","1",
"10R.3.2.14","1",
"10R.3.2.15","1",
"10R.3.2.18","1",
"10R.3.2.21","1",
"10R.3.2.25","1",
"10R.3.3.3.05","1",
"10R.3.3.3.06","1",
"10R.3.3.3.07","1",
"10R.3.3.3.09","1",
"10R.3.3.4.01","1",
"10R.3.4.1.01","1",
"10R.3.4.2.03","1",
"10R.3.4.2.04","1",
"10R.3.4.3.01","1",
"10R.3.4.4.02","1",
"10R.3.4.4.03","1",
"10R.3.4.4.04","1",
"10R.3.4.4.05","1",
"10R.3.4.5.02","1",
"10R.3.5.03","1",
"10R.3.5.04","1",
"10R.3.5.05","1",
"10R.4.1.1.01","1",
"10R.4.1.1.02","1",
"10R.4.1.1.04","1",
"10R.4.1.1.05","1",
"10R.4.2.01","1",
"10R.4.2.1.03","1",
"10R.4.2.1.04","1",
"10R.4.2.1.05","1",
"10R.4.2.1.08","1",
"10R.4.2.2.06","1",
"10R.4.2.3.01","1",
"10R.4.3.02","1",
"10R.4.4.01","1",
"10R.4.4.02","1",
"10R.4.4.05","1",
"10R.5.1.1.01","1",
"10R.5.1.1.02","1",
"10R.5.1.1.03","1",
"10R.5.1.1.04","1",
"10R.5.1.2.02","1",
"10R.5.1.2.03","1",
"10R.5.1.2.04","1",
"10R.5.1.2.05","1",
"10R.5.1.3.01","1",
"10R.5.1.3.05","1",
"10R.5.2.1.01","1",
"10R.5.2.1.02","1",
"10R.5.2.1.03","1",
"10R.5.2.1.04","1",
"10R.5.2.2.01","1",
"10R.5.2.2.02","1",
"10R.5.2.2.03","1",
"10R.5.2.2.04","1",
"10R.5.3.01","1",
"10R.5.3.02","1",
"10R.5.3.1.02","1",
"10R.5.3.1.04","1",
"10R.5.3.1.06","1",
"10R.5.3.2.01","1",
"10R.5.3.2.03","1",
"10R.6.1.1.02","1",
"10R.6.1.1.03","1",
"10R.6.1.1.04","1",
"10R.6.1.1.05","1",
"10R.6.1.2.02","1",
"10R.6.1.2.03","1",
"10R.6.1.2.05","1",
"10R.6.1.3.04","1",
"10R.6.1.3.05","1",
"10R.6.1.3.06","1",
"10R.6.1.4.01","1",
"10R.6.1.4.02","1",
"10R.6.1.4.03","1",
"10R.6.1.4.04","1",
"10R.6.1.4.05","1",
"10R.6.1.4.06","1",
"10R.6.1.5.02","1",
"10R.6.1.5.03","1",
"10R.6.1.5.04","1",
"10R.6.1.6.01","1",
"10R.6.1.6.02","1",
"10R.6.1.6.03","1",
"10R.6.1.6.04","1",
"10R.6.2.1.01","1",
"10R.6.2.1.02","1",
"10R.6.2.1.03","1",
"10R.6.2.1.04","1",
"10R.6.2.1.05","1",
"10R.6.2.1.06","1",
"10R.6.2.2.01","1",
"10R.6.2.2.02","1",
"10R.6.2.2.03","1",
"10R.6.2.2.04","1",
"10R.6.2.3.01","1",
"10R.6.2.3.02","1",
"10R.6.2.3.03","1",
"10R.6.2.3.04","1",
"10R.6.2.3.05","1",
"10R.6.2.3.06","1",
"10R.6.2.3.07","1",
"10R.6.2.3.08","1",
"10R.6.2.3.09","1",
"10R.6.2.3.10","1",
"10R.6.2.3.11","1",
"10SC.1.1.09","1",
"10SC.1.3.06","1",
"10SC.1.3.08","1",
"10SC.1.3.09","1",
"10SC.1.3.10","1",
"10SC.1.5.01","1",
"10SC.1.5.02","1",
"10SC.1.5.03","1",
"10SC.1.6.02","1",
"10SC.1.7.04","1",
"10SC.2.2.01","1",
"10SC.2.2.02","1",
"10SC.2.2.03","1",
"10SC.2.2.04","1",
"10SC.2.2.08","1",
"10SC.2.2.10","1",
"10SC.2.3.03","1",
"10SC.2.3.05","1",
"10SC.2.3.06","1",
"10SC.2.3.07","1",
"10SC.2.3.08","1",
"10SC.2.3.09","1",
"10SC.3.3.02","1",
"10SC.3.5.04","1",
"10SC.3.5.07","1",
"10SC.3.6.01","1",
"10SC.3.6.02","1",
"10SC.3.7.01","1",
"10SC.3.7.02","1",
"10SC.3.7.04","1",
"10SC.3.7.05","1",
"10SC.3.8.01","1",
"10SC.3.8.04","1",
"10SC.3.9.04","1",
"10SC.4.1.01","1",
"10SC.4.1.05","1",
"10SC.4.1.07","1",
"10SC.4.1.12","1",
"10SC.4.2.08","1",
"10SC.4.2.09","1",
"10SC.5.2.05","1",
"10SC.5.3.06","1",
"10SC.6.2.01","1",
"10SC.6.2.02","1",
"10SC.6.2.03","1",
"10SC.6.2.04","1",
"10SC.6.2.05","1",
"10SC.6.4.02","1",
"10SC.7.2.01","1",
"10SC.7.2.02","1",
"10SC.7.2.04","1",
"20R_SA_SR_TNsv","1",
"20R_SB_SR_TNsv","1",
"20R_SC_SR_TNsv","1",
"9M.2.3.4.06","1",
"9M.2.4.3.04","1",
"9M.3.4.3.02","1",
"9M.4.1.1.01","1",
"9M.4.1.2.02","1",
"9M.4.3.1.01","1",
"9M.4.3.2.02","1",
"9M.4.5.1.02","1",
"M19SVB.1","1",
"M19SVB.10","1",
"M19SVB.11","1",
"M19SVB.12","1",
"M19SVB.13","1",
"M19SVB.14","1",
"M19SVB.15","1",
"M19SVB.16","1",
"M19SVB.17","1",
"M19SVB.18","1",
"M19SVB.19","1",
"M19SVB.2","1",
"M19SVB.20","1",
"M19SVB.21","1",
"M19SVB.22","1",
"M19SVB.23","1",
"M19SVB.24","1",
"M19SVB.25","1",
"M19SVB.3","1",
"M19SVB.4","1",
"M19SVB.5","1",
"M19SVB.6","1",
"M19SVB.7","1",
"M19SVB.8","1",
"M19SVB.9","1",
"R19SVB.1","1",
"R19SVB.10","1",
"R19SVB.11","1",
"R19SVB.12","1",
"R19SVB.13","1",
"R19SVB.14","1",
"R19SVB.15","1",
"R19SVB.16","1",
"R19SVB.17","1",
"R19SVB.18","1",
"R19SVB.19","1",
"R19SVB.2","1",
"R19SVB.20","1",
"R19SVB.21","1",
"R19SVB.22","1",
"R19SVB.23","1",
"R19SVB.24","1",
"R19SVB.25","1",
"R19SVB.26","1",
"R19SVB.27","1",
"R19SVB.28","1",
"R19SVB.29","1",
"R19SVB.3","1",
"R19SVB.30","1",
"R19SVB.31","1",
"R19SVB.32","1",
"R19SVB.33","1",
"R19SVB.34","1",
"R19SVB.35","1",
"R19SVB.36","1",
"R19SVB.37","1",
"R19SVB.38","1",
"R19SVB.39","1",
"R19SVB.4","1",
"R19SVB.40","1",
"R19SVB.41","1",
"R19SVB.42","1",
"R19SVB.43","1",
"R19SVB.44","1",
"R19SVB.45","1",
"R19SVB.46","1",
"R19SVB.47","1",
"R19SVB.48","1",
"R19SVB.49","1",
"R19SVB.5","1",
"R19SVB.50","1",
"R19SVB.51","1",
"R19SVB.52","1",
"R19SVB.53","1",
"R19SVB.54","1",
"R19SVB.55","1",
"R19SVB.6","1",
"R19SVB.7","1",
"R19SVB.8","1",
"R19SVB.9","1",
"TN.10.MA.10.433.13","1",
"TN.10.MA.10.435.17","1",
"TN.10.MA.10.436.24","1",
"TN.10.MA.10.441.9","1",
"TN.10.MA.11.448.1","1",
"TN.10.MA.11.448.2","1",
"TN.10.MA.11.448.3","1",
"TN.10.MA.11.448.4","1",
"TN.10.MA.13.462.14","1",
"TN.10.MA.13.462.15","1",
"TN.10.MA.13.469.18","1",
"TN.10.MA.13.474.22","1",
"TN.10.MA.14.482.23","1",
"TN.10.MA.14.486.19","1",
"TN.10.MA.14.492.20","1",
"TN.10.MA.14.497.12","1",
"TN.10.MA.15.507.6","1",
"TN.10.MA.15.508.7","1",
"TN.10.MA.15.510.25","1",
"TN.10.MA.15.511.8","1",
"TN.10.MA.16.520.5","1",
"TN.10.MA.16.524.21","1",
"TN.10.MA.16.527.11","1",
"TN.10.MA.16.581.16","1",
"TN.10.MA.17.534.10","1",
"TN.10.RL.2.224.12","1",
"TN.10.RL.2.224.14","1",
"TN.10.RL.2.224.16","1",
"TN.10.RL.2.225.1","1",
"TN.10.RL.2.225.17","1",
"TN.10.RL.2.225.46","1",
"TN.10.RL.2.226.45","1",
"TN.10.RL.3.230.40","1",
"TN.10.RL.3.230.49","1",
"TN.10.RL.3.231.2","1",
"TN.10.RL.3.231.28","1",
"TN.10.RL.3.231.50","1",
"TN.10.RL.3.232.19","1",
"TN.10.RL.3.232.26","1",
"TN.10.RL.3.232.41","1",
"TN.10.RL.3.233.30","1",
"TN.10.RL.3.234.22","1",
"TN.10.RL.3.234.24","1",
"TN.10.RL.3.234.47","1",
"TN.10.RL.4.237.29","1",
"TN.10.RL.4.240.27","1",
"TN.10.RL.4.240.39","1",
"TN.10.RL.4.240.4","1",
"TN.10.RL.4.241.20","1",
"TN.10.RL.4.244.42","1",
"TN.10.RL.5.248.13","1",
"TN.10.RL.5.248.15","1",
"TN.10.RL.5.248.18","1",
"TN.10.RL.5.248.25","1",
"TN.10.RL.5.250.21","1",
"TN.10.RL.5.250.48","1",
"TN.10.RL.5.251.43","1",
"TN.10.RL.5.252.23","1",
"TN.10.RL.5.253.3","1",
"TN.10.RL.7.263.34","1",
"TN.10.RL.7.264.10","1",
"TN.10.RL.7.264.32","1",
"TN.10.RL.7.264.51","1",
"TN.10.RL.7.264.7","1",
"TN.10.RL.7.265.53","1",
"TN.10.RL.7.266.37","1",
"TN.10.RL.7.266.52","1",
"TN.10.RL.7.267.6","1",
"TN.10.RL.8.417.36","1",
"TN.10.RL.8.417.44","1",
"TN.10.RL.8.417.55","1",
"TN.10.RL.8.418.8","1",
"TN.10.RL.8.419.33","1",
"TN.10.RL.8.419.38","1",
"TN.10.RL.8.419.5","1",
"TN.10.RL.9.275.11","1",
"TN.10.RL.9.275.31","1",
"TN.10.RL.9.275.35","1",
"TN.10.RL.9.275.54","1",
"TN.10.RL.9.275.9","1"
);

my %seen = ();

if ($ARGV[0] eq "-h") {
	print "USAGE:\tperl listAll.ipl <dir>\nDESCRIPTION:\n\tThis script will generate a comma delimited list of itemids and job docs that reside inside <dir>\n"; 
	print "OPTIONS:\n\t-h prints this help message\n";
	exit 1;
}

sub process_file {
        my $keys;
        my $file = $File::Find::name;
        return unless -f $file || $file =~ /xml$/;
        return unless ($file =~ /WORKAREA/ && $file =~ /\/Job/);
	return if $file =~ /\/Test\//;
	# print "FILE: $file\n";
	$file =~ /^(.*\/WORKAREA\/load)\/(.*)$/;
	# print "File: $2, AREA: $1\n"; 
	my %items = &CTB::RegEx::get_items($2, $1);
	foreach $keys (keys %items) {
		next if $seen{$keys};
		next unless $missing_items{$keys}; 
		$seen{$keys} = 1;
		# print "$keys,$file\n";
		my $task_name;
		my $job_details = `$iwhome/bin/iwgetfilejobs $file`;
		$job_details =~ /job=([^\s]+).*task=([^\s]+)/;
		# next unless defined $1 && defined $2;
                # next if $2 < 100;
		my ($jobid, $taskid) = ($1, $2);
		my $task_details = `$iwhome/bin/iwgetwfobj $taskid`;
			
		while ($task_details =~ /name="([^"]+)/) {
			$task_name =$1;
			last;
		}
		print "$keys,$file,$jobid,$task_name\n";
	}
	# print "File: " . $file . "\n";
 	       
}
find(\&process_file, @ARGV);
